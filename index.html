<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cube Forge Tycoon</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="scanline"></div>
  <div class="app-shell">
    <header class="topbar">
      <div class="title-block">
        <h1>Cube Forge Tycoon</h1>
        <p class="subtitle">Smash the cube, invest in high-tech production, and rebirth for exponential profit.</p>
      </div>
      <div class="stat-grid">
        <div class="stat">
          <span class="label">Energy</span>
          <span class="value" id="energyDisplay">0</span>
        </div>
        <div class="stat">
          <span class="label">Clicks</span>
          <span class="value" id="clickDisplay">0</span>
        </div>
        <div class="stat">
          <span class="label">Essence</span>
          <span class="value" id="essenceDisplay">0</span>
        </div>
        <div class="stat">
          <span class="label">Energy / Click</span>
          <span class="value" id="epcDisplay">1</span>
        </div>
        <div class="stat">
          <span class="label">Energy / Sec</span>
          <span class="value" id="epsDisplay">0</span>
        </div>
        <div class="stat">
          <span class="label">Ascension Mult.</span>
          <span class="value" id="multiplierDisplay">x1.00</span>
        </div>
      </div>
    </header>

    <main class="layout">
      <section class="game-panel">
        <div class="cube-case">
          <div class="cube-glow"></div>
          <div id="square"></div>
        </div>
        <div class="phrase-box">
          <span id="phrase">Prime the cube to spin up production.</span>
        </div>
        <div class="progress-tray">
          <div class="progress-card">
            <div class="progress-label">Ascension Charge</div>
            <div class="progress-bar">
              <div id="ascensionProgress" class="progress-fill" style="width:0%"></div>
            </div>
            <div class="progress-details" id="ascensionDetail">0 / 1,000 energy (best run: 0)</div>
          </div>
          <div class="progress-card">
            <div class="progress-label">Combo</div>
            <div class="progress-value" id="comboDisplay">0</div>
          </div>
          <div class="progress-card">
            <div class="progress-label">Longest Combo</div>
            <div class="progress-value" id="longestComboDisplay">0</div>
          </div>
        </div>
      </section>

      <section class="side-panels">
        <div class="card">
          <h2>Upgrades</h2>
          <p class="card-subtitle">Boost manual clicks and forge-wide bonuses.</p>
          <div id="upgradeList" class="upgrade-list"></div>
        </div>

        <div class="card">
          <h2>Automation</h2>
          <p class="card-subtitle">Hire teams and build rigs for passive energy.</p>
          <div id="generatorList" class="generator-list"></div>
        </div>

        <div class="card">
          <h2>Achievements</h2>
          <p class="card-subtitle">Milestones that hand out juicy rewards.</p>
          <div id="achievementList" class="achievement-list"></div>
        </div>

        <div class="card rebirth-card">
          <h2>Ascension</h2>
          <p class="card-subtitle">Cash out a run for essence and permanent multipliers.</p>
          <button id="rebirthButton" class="primary" disabled>Ascend (+0 essence)</button>
          <p class="hint" id="rebirthHint">Reach 1,000 energy to ascend.</p>
        </div>

        <div class="card history-card">
          <h2>Activity Feed</h2>
          <div id="history" class="history-list"></div>
        </div>
      </section>
    </main>
  </div>

  <script src="phrases.js"></script>
  <script>
    const gameState = {
      energy: 0,
      totalClicks: 0,
      energyPerClick: 1,
      ascensionMultiplier: 1,
      essence: 0,
      ascensions: 0,
      ascensionGoal: 1000,
      upgradeCounts: {},
      generatorCounts: {},
      achievementsUnlocked: new Set(),
      passiveMultiplier: 1,
      generatorCostDiscount: 0,
      shatterChance: 0,
      essenceBonusMultiplier: 0,
      totalEnergyGenerated: 0,
      lifetimeEnergy: 0,
      highestEnergy: 0,
      combo: 0,
      longestCombo: 0,
    };

    const upgrades = [
      {
        id: 'softTouch',
        name: 'Ergonomic Gloves',
        description: '+1 energy per click.',
        baseCost: 40,
        scaling: 1.2,
        effect: state => {
          state.energyPerClick += 1;
        },
      },
      {
        id: 'precisionPolish',
        name: 'Precision Polish',
        description: '+5 energy per click.',
        baseCost: 180,
        scaling: 1.28,
        effect: state => {
          state.energyPerClick += 5;
        },
      },
      {
        id: 'prismaticLens',
        name: 'Prismatic Lens',
        description: 'Doubles energy per click.',
        baseCost: 450,
        scaling: 1.45,
        effect: state => {
          state.energyPerClick *= 2;
        },
      },
      {
        id: 'quantumGrip',
        name: 'Quantum Grip',
        description: '+0.25 ascension multiplier.',
        baseCost: 900,
        scaling: 1.55,
        effect: state => {
          state.ascensionMultiplier += 0.25;
        },
      },
      {
        id: 'overclockedCores',
        name: 'Overclocked Cores',
        description: '+25% passive production.',
        baseCost: 1350,
        scaling: 1.6,
        effect: state => {
          state.passiveMultiplier += 0.25;
        },
      },
      {
        id: 'holoArchitects',
        name: 'Holo Architects',
        description: 'Generator costs -5%.',
        baseCost: 2200,
        scaling: 1.65,
        effect: state => {
          state.generatorCostDiscount = Math.min(0.5, state.generatorCostDiscount + 0.05);
        },
      },
      {
        id: 'realityFracturer',
        name: 'Reality Fracturer',
        description: '8% chance to double a click.',
        baseCost: 3600,
        scaling: 1.75,
        effect: state => {
          state.shatterChance = Math.min(0.6, state.shatterChance + 0.08);
        },
      },
      {
        id: 'temporalAnchor',
        name: 'Temporal Anchor',
        description: '+20% essence on ascension.',
        baseCost: 5200,
        scaling: 1.85,
        effect: state => {
          state.essenceBonusMultiplier += 0.2;
        },
      },
    ];

    const generators = [
      {
        id: 'cubeApprentice',
        name: 'Cube Apprentice',
        description: 'Hand-crafted cubes for steady income.',
        baseCost: 75,
        scaling: 1.18,
        baseRate: 2,
      },
      {
        id: 'laserEtcher',
        name: 'Laser Etcher',
        description: 'Industrial lasers carve power cores.',
        baseCost: 320,
        scaling: 1.22,
        baseRate: 8,
      },
      {
        id: 'replicationBay',
        name: 'Replication Bay',
        description: 'Duplicators print cubes around the clock.',
        baseCost: 1200,
        scaling: 1.26,
        baseRate: 30,
      },
      {
        id: 'chronalVault',
        name: 'Chronal Vault',
        description: 'Loops time to harvest yesterday\'s gains.',
        baseCost: 4600,
        scaling: 1.3,
        baseRate: 110,
      },
      {
        id: 'riftHarvester',
        name: 'Rift Harvester',
        description: 'Extracts energy from alternate realities.',
        baseCost: 15000,
        scaling: 1.33,
        baseRate: 400,
      },
    ];

    const achievements = [
      {
        id: 'firstClick',
        name: 'Square One',
        description: 'Click the cube once.',
        reward: '+50 energy',
        condition: state => state.totalClicks >= 1,
        onUnlock: state => {
          state.energy += 50;
          logMoment('Rewarded 50 energy for touching the cube!');
        },
      },
      {
        id: 'clickMachine',
        name: 'Click Machine',
        description: 'Reach 500 manual clicks.',
        reward: '+2 energy per click',
        condition: state => state.totalClicks >= 500,
        onUnlock: state => {
          state.energyPerClick += 2;
        },
      },
      {
        id: 'energyCollector',
        name: 'Energy Collector',
        description: 'Bank 10,000 lifetime energy.',
        reward: '+0.10 ascension multiplier',
        condition: state => state.lifetimeEnergy >= 10000,
        onUnlock: state => {
          state.ascensionMultiplier += 0.1;
        },
      },
      {
        id: 'upgradeFan',
        name: 'Upgrade Fanatic',
        description: 'Purchase 10 upgrades.',
        reward: '+250 energy',
        condition: state => totalUpgradesPurchased() >= 10,
        onUnlock: state => {
          state.energy += 250;
        },
      },
      {
        id: 'autoFactory',
        name: 'Automation Nation',
        description: 'Own 15 automation items.',
        reward: '+15% passive production',
        condition: state => totalGeneratorsOwned() >= 15,
        onUnlock: state => {
          state.passiveMultiplier += 0.15;
        },
      },
      {
        id: 'epsCentury',
        name: 'Century Per Second',
        description: 'Generate 100 energy per second.',
        reward: '+1 essence',
        condition: state => computeEnergyPerSecond() >= 100,
        onUnlock: state => {
          state.essence += 1;
        },
      },
      {
        id: 'comboMaster',
        name: 'Combo Master',
        description: 'Hit a 30 click combo streak.',
        reward: '+0.25 ascension multiplier',
        condition: state => state.longestCombo >= 30,
        onUnlock: state => {
          state.ascensionMultiplier += 0.25;
        },
      },
      {
        id: 'firstAscension',
        name: 'First Reboot',
        description: 'Ascend once.',
        reward: 'Gain 2 essence',
        condition: state => state.ascensions >= 1,
        onUnlock: state => {
          state.essence += 2;
          logMoment('Fresh essence delivered for your first reboot.');
        },
      },
      {
        id: 'essenceStockpile',
        name: 'Essence Stockpile',
        description: 'Accumulate 15 essence.',
        reward: 'Permanent +10% passive production',
        condition: state => state.essence >= 15,
        onUnlock: state => {
          state.passiveMultiplier += 0.1;
        },
      },
      {
        id: 'industrialMagnate',
        name: 'Industrial Magnate',
        description: 'Earn 1,000,000 lifetime energy.',
        reward: 'Every click grants +5% more energy',
        condition: state => state.lifetimeEnergy >= 1000000,
        onUnlock: state => {
          state.energyPerClick *= 1.05;
        },
      },
    ];

    const square = document.getElementById('square');
    const phraseText = document.getElementById('phrase');
    const historyBox = document.getElementById('history');
    const energyDisplay = document.getElementById('energyDisplay');
    const clickDisplay = document.getElementById('clickDisplay');
    const epcDisplay = document.getElementById('epcDisplay');
    const epsDisplay = document.getElementById('epsDisplay');
    const multiplierDisplay = document.getElementById('multiplierDisplay');
    const essenceDisplay = document.getElementById('essenceDisplay');
    const upgradeList = document.getElementById('upgradeList');
    const generatorList = document.getElementById('generatorList');
    const achievementList = document.getElementById('achievementList');
    const rebirthButton = document.getElementById('rebirthButton');
    const rebirthHint = document.getElementById('rebirthHint');
    const ascensionProgress = document.getElementById('ascensionProgress');
    const ascensionDetail = document.getElementById('ascensionDetail');
    const comboDisplay = document.getElementById('comboDisplay');
    const longestComboDisplay = document.getElementById('longestComboDisplay');

    let comboTimeout;

    function randomColorPair() {
      const hue = Math.floor(Math.random() * 360);
      const primary = `hsl(${hue}, 85%, 55%)`;
      const secondaryHue = (hue + 20) % 360;
      const secondary = `hsl(${secondaryHue}, 80%, 60%)`;
      const glow = `hsla(${hue}, 85%, 60%, 0.65)`;
      return { primary, secondary, glow };
    }

    function applyCubeColors({ primary, secondary, glow }) {
      const root = document.documentElement;
      root.style.setProperty('--cube-color-primary', primary);
      root.style.setProperty('--cube-color-secondary', secondary);
      root.style.setProperty('--glow-color', glow);
    }

    function formatNumber(value) {
      if (value >= 1e12) return (value / 1e12).toFixed(2) + 'T';
      if (value >= 1e9) return (value / 1e9).toFixed(2) + 'B';
      if (value >= 1e6) return (value / 1e6).toFixed(2) + 'M';
      if (value >= 1e3) return (value / 1e3).toFixed(2) + 'K';
      if (value >= 100) return Math.floor(value).toLocaleString();
      if (value >= 10) return value.toFixed(1);
      return value.toFixed(2);
    }

    function logMoment(text) {
      const entry = document.createElement('div');
      entry.className = 'history-entry';
      entry.textContent = text;
      historyBox.prepend(entry);
      const limit = 60;
      while (historyBox.children.length > limit) {
        historyBox.removeChild(historyBox.lastChild);
      }
    }

    function totalUpgradesPurchased() {
      return Object.values(gameState.upgradeCounts).reduce((total, count) => total + count, 0);
    }

    function totalGeneratorsOwned() {
      return Object.values(gameState.generatorCounts).reduce((total, count) => total + count, 0);
    }

    function computeEnergyPerSecond() {
      let rate = 0;
      generators.forEach(generator => {
        const count = gameState.generatorCounts[generator.id] || 0;
        if (!count) return;
        rate += generator.baseRate * count;
      });
      rate *= gameState.passiveMultiplier;
      rate *= gameState.ascensionMultiplier;
      return rate;
    }

    function updateStats() {
      energyDisplay.textContent = formatNumber(gameState.energy);
      clickDisplay.textContent = formatNumber(gameState.totalClicks);
      epcDisplay.textContent = formatNumber(gameState.energyPerClick * gameState.ascensionMultiplier);
      const eps = computeEnergyPerSecond();
      epsDisplay.textContent = formatNumber(eps);
      multiplierDisplay.textContent = 'x' + (gameState.ascensionMultiplier).toFixed(2);
      essenceDisplay.textContent = formatNumber(gameState.essence);
      comboDisplay.textContent = gameState.combo;
      longestComboDisplay.textContent = gameState.longestCombo;

      const progress = Math.min(1, gameState.energy / gameState.ascensionGoal);
      ascensionProgress.style.width = `${progress * 100}%`;
      ascensionDetail.textContent = `${formatNumber(gameState.energy)} / ${formatNumber(gameState.ascensionGoal)} energy (best run: ${formatNumber(gameState.highestEnergy)})`;

      const ascendable = gameState.energy >= gameState.ascensionGoal;
      rebirthButton.disabled = !ascendable;
      const baseEssenceGain = Math.floor(gameState.highestEnergy / gameState.ascensionGoal);
      const totalGain = ascendable ? Math.max(1, Math.floor(baseEssenceGain * (1 + gameState.essenceBonusMultiplier))) : Math.max(0, Math.floor(baseEssenceGain * (1 + gameState.essenceBonusMultiplier)));
      rebirthButton.textContent = ascendable ? `Ascend (+${formatNumber(totalGain)} essence)` : `Ascend (+${formatNumber(totalGain)} essence)`;
      rebirthHint.textContent = ascendable ? 'Ascend now to reset for massive multipliers.' : `Reach ${formatNumber(gameState.ascensionGoal)} energy to ascend.`;
    }

    function renderUpgrades() {
      upgradeList.innerHTML = '';
      upgrades.forEach(upgrade => {
        const count = gameState.upgradeCounts[upgrade.id] || 0;
        const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.scaling, count));
        const upgradeEl = document.createElement('button');
        upgradeEl.className = 'upgrade-item';
        upgradeEl.innerHTML = `
          <div class="upgrade-header">
            <span class="upgrade-name">${upgrade.name}</span>
            <span class="upgrade-cost">${formatNumber(cost)} ⚡</span>
          </div>
          <div class="upgrade-body">
            <span class="upgrade-description">${upgrade.description}</span>
            <span class="upgrade-owned">Owned: ${count}</span>
          </div>`;
        upgradeEl.disabled = gameState.energy < cost;
        upgradeEl.addEventListener('click', () => {
          if (gameState.energy < cost) return;
          gameState.energy -= cost;
          upgrade.effect(gameState);
          gameState.upgradeCounts[upgrade.id] = count + 1;
          logMoment(`Upgrade secured: ${upgrade.name}`);
          renderUpgrades();
          updateStats();
          evaluateAchievements();
        });
        upgradeList.appendChild(upgradeEl);
      });
    }

    function renderGenerators() {
      generatorList.innerHTML = '';
      generators.forEach(generator => {
        const count = gameState.generatorCounts[generator.id] || 0;
        const discount = 1 - gameState.generatorCostDiscount;
        const cost = Math.floor(generator.baseCost * Math.pow(generator.scaling, count) * discount);
        const generatorEl = document.createElement('button');
        generatorEl.className = 'generator-item';
        generatorEl.innerHTML = `
          <div class="generator-header">
            <span class="generator-name">${generator.name}</span>
            <span class="generator-cost">${formatNumber(cost)} ⚡</span>
          </div>
          <div class="generator-body">
            <span class="generator-description">${generator.description}</span>
            <span class="generator-owned">Owned: ${count}</span>
            <span class="generator-rate">${formatNumber(generator.baseRate * gameState.passiveMultiplier * gameState.ascensionMultiplier)} /s each</span>
          </div>`;
        generatorEl.disabled = gameState.energy < cost;
        generatorEl.addEventListener('click', () => {
          if (gameState.energy < cost) return;
          gameState.energy -= cost;
          gameState.generatorCounts[generator.id] = count + 1;
          logMoment(`Automation online: ${generator.name}`);
          renderGenerators();
          updateStats();
          evaluateAchievements();
        });
        generatorList.appendChild(generatorEl);
      });
    }

    function renderAchievements() {
      achievementList.innerHTML = '';
      achievements.forEach(achievement => {
        const unlocked = gameState.achievementsUnlocked.has(achievement.id);
        const entry = document.createElement('div');
        entry.className = 'achievement-item' + (unlocked ? ' unlocked' : '');
        entry.innerHTML = `
          <div class="achievement-header">
            <span class="achievement-name">${achievement.name}</span>
            <span class="achievement-reward">${achievement.reward}</span>
          </div>
          <p class="achievement-description">${achievement.description}</p>`;
        achievementList.appendChild(entry);
      });
    }

    function evaluateAchievements() {
      achievements.forEach(achievement => {
        if (gameState.achievementsUnlocked.has(achievement.id)) return;
        if (achievement.condition(gameState)) {
          gameState.achievementsUnlocked.add(achievement.id);
          achievement.onUnlock(gameState);
          logMoment(`Achievement unlocked: ${achievement.name}!`);
          renderAchievements();
          updateStats();
        }
      });
    }

    function grantPassiveEnergy(delta) {
      if (delta <= 0) return;
      gameState.energy += delta;
      gameState.totalEnergyGenerated += delta;
      gameState.lifetimeEnergy += delta;
      gameState.highestEnergy = Math.max(gameState.highestEnergy, gameState.energy);
    }

    function handleClick() {
      applyCubeColors(randomColorPair());
      const phrase = phrases[Math.floor(Math.random() * phrases.length)];
      phraseText.textContent = phrase;
      logMoment(phrase);

      gameState.totalClicks++;
      gameState.combo += 1;
      gameState.longestCombo = Math.max(gameState.longestCombo, gameState.combo);

      clearTimeout(comboTimeout);
      comboTimeout = setTimeout(() => {
        gameState.combo = 0;
        updateStats();
      }, 1200);

      const baseGain = gameState.energyPerClick * gameState.ascensionMultiplier;
      const doubled = Math.random() < gameState.shatterChance;
      const gain = doubled ? baseGain * 2 : baseGain;
      if (doubled) {
        logMoment('Critical shatter! Click value doubled.');
      }

      gameState.energy += gain;
      gameState.totalEnergyGenerated += gain;
      gameState.lifetimeEnergy += gain;
      gameState.highestEnergy = Math.max(gameState.highestEnergy, gameState.energy);

      if (gameState.combo && gameState.combo % 25 === 0) {
        logMoment(`Combo ${gameState.combo}! Keep slamming that cube.`);
      }

      updateStats();
      renderUpgrades();
      renderGenerators();
      evaluateAchievements();
    }

    function performAscension() {
      if (gameState.energy < gameState.ascensionGoal) return;
      const baseEssenceGain = Math.floor(gameState.highestEnergy / gameState.ascensionGoal);
      const essenceGain = Math.max(1, Math.floor(baseEssenceGain * (1 + gameState.essenceBonusMultiplier)));
      gameState.essence += essenceGain;
      gameState.ascensionMultiplier += 0.35 + essenceGain * 0.12;
      gameState.ascensions += 1;
      logMoment(`Ascended and gained ${formatNumber(essenceGain)} essence! Multipliers boosted.`);

      gameState.energy = 0;
      gameState.totalClicks = 0;
      gameState.energyPerClick = 1;
      gameState.upgradeCounts = {};
      gameState.generatorCounts = {};
      gameState.passiveMultiplier = 1;
      gameState.generatorCostDiscount = 0;
      gameState.shatterChance = 0;
      gameState.essenceBonusMultiplier = 0;
      gameState.ascensionGoal = Math.floor(gameState.ascensionGoal * 2.3);
      gameState.combo = 0;
      gameState.longestCombo = 0;
      gameState.highestEnergy = 0;

      renderUpgrades();
      renderGenerators();
      renderAchievements();
      updateStats();
      evaluateAchievements();
    }

    square.addEventListener('click', handleClick);
    rebirthButton.addEventListener('click', performAscension);

    applyCubeColors(randomColorPair());
    renderUpgrades();
    renderGenerators();
    renderAchievements();
    updateStats();

    setInterval(() => {
      const eps = computeEnergyPerSecond();
      if (eps > 0) {
        const delta = eps / 10;
        grantPassiveEnergy(delta);
        updateStats();
        evaluateAchievements();
      }
    }, 100);
  </script>
</body>
</html>
